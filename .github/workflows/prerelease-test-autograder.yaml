name: Test run of autograder for pre-release

on:
  push:
    branches:
      - hw1-prerelease

jobs:
  p1:
    name: Problem 1
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Does filter_after_cutoff_age use SQL?
        uses: devcontainers/ci@v0.3
        with:
          cacheFrom: ghcr.io/wustl-data/autograder
          push: never
          runCmd: pytesttests/local/test_autograde.py::test_1_uses_sql

  p2:
    name: Problem 2
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Login to GitHub Container Registry
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: Does avg_per_state avoid using SQL?
        run: pytest tests/local/test_autograde.py::test_2_uses_pandas

  p3:
    name: Problem 3
    runs-on: ubuntu-latest
    steps:

      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Does your test cover all example cases?
        uses: devcontainers/ci@v0.3
        with:
          cacheFrom: ghcr.io/wustl-data/autograder
          push: never
          runCmd: poetry run pytest tests/local/test_autograde.py::test_1_uses_sql
  p4:
    name: Problem 4
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Does your implementation get your test to pass?
        run: poetry run pytest tests/local/test_hw1.py::test_large_states_adult_age
  p5:
    name: Problem 5
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Does your implementation get your test to pass?
        run: poetry run pytest tests/local/test_hw1.py::test_large_states_adult_age
  p6:
    name: Problem 6
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Does your test cover all example cases?
        uses: devcontainers/ci@v0.3
        with:
          cacheFrom: ghcr.io/wustl-data/autograder
          push: never
      - name: Does your implementation get your test to pass?
        run: poetry run pytest /workspaces/autograder/tests/hidden/test_action.py::test_autograder_generate_people
  p7:
    name: Problem 7
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Does your implementation get your test to pass?
        run: pytest tests/local/test_hw1.py::test_large_states_adult_age

      - name: Does your test cover all example cases?
        run: docker run -w /workspaces/autograder -v .:/workspaces/autograder ghcr.io/wustl-data/autograder pytest /workspaces/autograder/tests/hidden/test_action.py::test_autograder_generate_people
  p8:
    name: Problem 8
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Does your implementation get your test to pass?
        run: pytest tests/local/test_hw1.py::test_generate_people.py
